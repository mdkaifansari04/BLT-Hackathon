{% extends "base.html" %}
{% load static %}
{% block title %}
    {{ title }} - Hackathon
{% endblock title %}
{% block content %}
    <div class="container mx-auto px-4 py-8">
        <div class="max-w-5xl mx-auto">
            <!-- Header -->
            <div class="mb-8">
                <h1 class="text-4xl font-bold text-gray-900 dark:text-gray-100 mb-2">{{ title }}</h1>
                <p class="text-lg text-gray-600 dark:text-gray-400">Configure your hackathon details and settings</p>
            </div>
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-8">
                <form method="post" enctype="multipart/form-data" class="space-y-10">
                    {% csrf_token %}
                    {% if form.non_field_errors %}
                        <div class="mb-6 p-4 bg-red-50 border border-red-200 text-red-700 rounded-lg">{{ form.non_field_errors }}</div>
                    {% endif %}
                    <!-- Basic Information Section -->
                    <div class="space-y-6">
                        <h2 class="text-2xl font-bold text-gray-900 dark:text-gray-100 pb-2 border-b-2 border-[#e74c3c]">Basic Information</h2>
                        <!-- Name -->
                        <div>
                            <label for="{{ form.name.id_for_label }}"
                                   class="block text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2">
                                Hackathon Name <span class="text-[#e74c3c]">*</span>
                            </label>
                            <input type="text" name="{{ form.name.name }}" value="{{ form.name.value|default:'' }}" id="{{ form.name.id_for_label }}" class="mt-1 p-3 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-[#e74c3c] focus:ring focus:ring-[#e74c3c] focus:ring-opacity-50 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100" placeholder="Enter hackathon name">
                            {% if form.name.errors %}<p class="mt-2 text-sm text-red-600">{{ form.name.errors.0 }}</p>{% endif %}
                        </div>
                        <!-- Organization OR Owner (conditional) -->
                        {% if has_organization %}
                        <div>
                            <label for="{{ form.organization.id_for_label }}"
                                   class="block text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2">
                                Organization <span class="text-[#e74c3c]">*</span>
                            </label>
                            <select name="{{ form.organization.name }}" id="{{ form.organization.id_for_label }}" class="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-[#e74c3c] focus:ring focus:ring-[#e74c3c] focus:ring-opacity-50 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                                <option value="">Select an organization</option>
                                {% for choice in form.organization.field.queryset %}
                                    <option value="{{ choice.pk }}" {% if form.organization.value == choice.pk %}selected{% endif %}>{{ choice }}</option>
                                {% endfor %}
                            </select>
                            {% if form.organization.errors %}<p class="mt-2 text-sm text-red-600">{{ form.organization.errors.0 }}</p>{% endif %}
                            <p class="mt-2 text-sm text-gray-600 dark:text-gray-400">
                                Organization hosting this hackathon with repository access.
                            </p>
                        </div>
                        {% else %}
                        <div>
                            <label for="{{ form.owner.id_for_label }}"
                                   class="block text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2">
                                Owner <span class="text-[#e74c3c]">*</span>
                            </label>
                            <select name="{{ form.owner.name }}" id="{{ form.owner.id_for_label }}" class="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-[#e74c3c] focus:ring focus:ring-[#e74c3c] focus:ring-opacity-50 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                                <option value="">Select an owner</option>
                                {% for choice in form.owner.field.queryset %}
                                    <option value="{{ choice.pk }}" {% if form.owner.value == choice.pk %}selected{% endif %}>{{ choice }}</option>
                                {% endfor %}
                            </select>
                            {% if form.owner.errors %}<p class="mt-2 text-sm text-red-600">{{ form.owner.errors.0 }}</p>{% endif %}
                            <p class="mt-2 text-sm text-gray-600 dark:text-gray-400">
                                The user who owns and manages this hackathon.
                            </p>
                        </div>
                        {% endif %}
                        <!-- Description -->
                        <div>
                            <label for="{{ form.description.id_for_label }}"
                                   class="block text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2">
                                Description <span class="text-[#e74c3c]">*</span>
                            </label>
                            <textarea name="{{ form.description.name }}" id="{{ form.description.id_for_label }}" rows="4" class="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-[#e74c3c] focus:ring focus:ring-[#e74c3c] focus:ring-opacity-50 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100" placeholder="Describe your hackathon...">{{ form.description.value|default:'' }}</textarea>
                            {% if form.description.errors %}<p class="mt-2 text-sm text-red-600">{{ form.description.errors.0 }}</p>{% endif %}
                        </div>
                    </div>
                    <!-- Schedule & Settings Section -->
                    <div class="space-y-6">
                        <h2 class="text-2xl font-bold text-gray-900 dark:text-gray-100 pb-2 border-b-2 border-[#e74c3c]">
                            Schedule & Settings
                        </h2>
                        <!-- Time Section -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Start Time -->
                            <div>
                                <label for="{{ form.start_time.id_for_label }}"
                                       class="block text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2">
                                    Start Time <span class="text-[#e74c3c]">*</span>
                                </label>
                                <input type="datetime-local" name="{{ form.start_time.name }}" value="{{ form.start_time.value|default:'' }}" id="{{ form.start_time.id_for_label }}" class="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-[#e74c3c] focus:ring focus:ring-[#e74c3c] focus:ring-opacity-50 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                                {% if form.start_time.errors %}<p class="mt-2 text-sm text-red-600">{{ form.start_time.errors.0 }}</p>{% endif %}
                            </div>
                            <!-- End Time -->
                            <div>
                                <label for="{{ form.end_time.id_for_label }}"
                                       class="block text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2">
                                    End Time <span class="text-[#e74c3c]">*</span>
                                </label>
                                <input type="datetime-local" name="{{ form.end_time.name }}" value="{{ form.end_time.value|default:'' }}" id="{{ form.end_time.id_for_label }}" class="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-[#e74c3c] focus:ring focus:ring-[#e74c3c] focus:ring-opacity-50 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                                {% if form.end_time.errors %}<p class="mt-2 text-sm text-red-600">{{ form.end_time.errors.0 }}</p>{% endif %}
                            </div>
                        </div>
                        <!-- Registration Settings -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Registration Open -->
                            <div class="flex items-center space-x-3 p-4 bg-gray-50 dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700">
                                <input type=\"checkbox\" name=\"{{ form.registration_open.name }}\" id=\"{{ form.registration_open.id_for_label }}\" class=\"h-4 w-4 text-[#e74c3c] focus:ring-[#e74c3c] border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700\" {% if form.registration_open.value %}checked{% endif %}>
                                <label for=\"{{ form.registration_open.id_for_label }}\"
                                       class=\"text-lg font-semibold text-gray-900 dark:text-gray-100\">
                                    Registration Open
                                </label>
                                {% if form.registration_open.errors %}
                                    <p class=\"mt-2 text-sm text-red-600\">{{ form.registration_open.errors.0 }}</p>
                                {% endif %}
                            </div>
                            <!-- Max Participants -->
                            <div>
                                <label for="{{ form.max_participants.id_for_label }}"
                                       class="block text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2">
                                    Max Participants
                                </label>
                                <input type="number" name="{{ form.max_participants.name }}" value="{{ form.max_participants.value|default:'' }}" id="{{ form.max_participants.id_for_label }}" class="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-[#e74c3c] focus:ring focus:ring-[#e74c3c] focus:ring-opacity-50 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100" placeholder="e.g., 100" min="1">
                                {% if form.max_participants.errors %}
                                    <p class="mt-2 text-sm text-red-600">{{ form.max_participants.errors.0 }}</p>
                                {% endif %}
                                <p class="mt-2 text-sm text-gray-600 dark:text-gray-400">Leave blank for unlimited participants</p>
                            </div>
                        </div>
                    </div>
                    <!-- Visual Design Section -->
                    <div class="space-y-6">
                        <h2 class="text-2xl font-bold text-gray-900 dark:text-gray-100 pb-2 border-b-2 border-[#e74c3c]">Visual Design</h2>
                        <!-- Banner Image -->
                        <div>
                            <label for="{{ form.banner_image.id_for_label }}"
                                   class="block text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2">
                                Banner Image
                            </label>
                            <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 dark:border-gray-600 border-dashed rounded-lg hover:border-[#e74c3c] transition-colors">
                                <div class="space-y-1 text-center">
                                    <input type="file" name="{{ form.banner_image.name }}" id="{{ form.banner_image.id_for_label }}" accept="image/*" class="block w-full text-sm text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600 rounded-md cursor-pointer bg-white dark:bg-gray-700 focus:outline-none focus:border-[#e74c3c] focus:ring focus:ring-[#e74c3c] focus:ring-opacity-50">
                                    <p class="text-sm text-gray-600 dark:text-gray-400">Recommended size: 1200x400 pixels</p>
                                </div>
                            </div>
                            {% if form.banner_image.errors %}<p class="mt-2 text-sm text-red-600">{{ form.banner_image.errors.0 }}</p>{% endif %}
                        </div>
                    </div>
                    <!-- Rules & Guidelines Section -->
                    <div class="space-y-6">
                        <h2 class="text-2xl font-bold text-gray-900 dark:text-gray-100 pb-2 border-b-2 border-[#e74c3c]">
                            Rules & Guidelines
                        </h2>
                        <!-- Rules -->
                        <div>
                            <label for="{{ form.rules.id_for_label }}"
                                   class="block text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2">
                                Hackathon Rules
                            </label>
                            <textarea name="{{ form.rules.name }}" id="{{ form.rules.id_for_label }}" rows="6" class="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-[#e74c3c] focus:ring focus:ring-[#e74c3c] focus:ring-opacity-50 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100" placeholder="Enter hackathon rules and guidelines...">{{ form.rules.value|default:'' }}</textarea>
                            {% if form.rules.errors %}<p class="mt-2 text-sm text-red-600">{{ form.rules.errors.0 }}</p>{% endif %}
                            <p class="mt-2 text-sm text-gray-600 dark:text-gray-400">
                                Define the rules and guidelines for your hackathon participants
                            </p>
                        </div>
                    </div>
                    <!-- Repositories Section -->
                    <div class="space-y-6 p-6 bg-gray-50 dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700">
                        <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100">Repositories</h3>
                        <p class="text-sm text-gray-600 dark:text-gray-400">
                            Configure which repositories will be part of this hackathon. Pull requests to these repositories during the hackathon period will be counted.
                        </p>
                        <!-- Existing Repositories -->
                        <div>
                            <label for="{{ form.repositories.id_for_label }}"
                                   class="block text-base font-semibold text-gray-900 dark:text-gray-100 mb-2">
                                Select Existing Repositories
                            </label>
                            <div class="relative">
                                <select name="{{ form.repositories.name }}" id="{{ form.repositories.id_for_label }}" multiple class="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-[#e74c3c] focus:ring focus:ring-[#e74c3c] focus:ring-opacity-50 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100" size="5">
                                    {% for choice in form.repositories.field.queryset %}
                                        <option value="{{ choice.pk }}" {% if choice.pk in form.repositories.value %}selected{% endif %}>{{ choice }}</option>
                                    {% endfor %}
                                </select>
                                <div id="repositories-loading" class="mt-2 hidden">
                                    <p class="text-sm text-gray-600 dark:text-gray-400">Loading repositories...</p>
                                </div>
                                <div id="no-repositories-message" class="mt-2 hidden">
                                    <p class="text-sm text-gray-600 dark:text-gray-400">No existing repositories found. You can add new ones below.</p>
                                </div>
                            </div>
                            {% if form.repositories.errors %}<p class="mt-2 text-sm text-red-600">{{ form.repositories.errors.0 }}</p>{% endif %}
                        </div>
                        <!-- New Repositories -->
                        <div>
                            <label for="{{ form.new_repo_urls.id_for_label }}"
                                   class="block text-base font-semibold text-gray-900 dark:text-gray-100 mb-2">
                                Add New Repositories
                            </label>
                            <textarea name="{{ form.new_repo_urls.name }}" id="{{ form.new_repo_urls.id_for_label }}" rows="4" class="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-[#e74c3c] focus:ring focus:ring-[#e74c3c] focus:ring-opacity-50 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100" placeholder="https://github.com/owner/repo1&#10;https://github.com/owner/repo2&#10;...">{{ form.new_repo_urls.value|default:'' }}</textarea>
                            {% if form.new_repo_urls.errors %}
                                <p class="mt-2 text-sm text-red-600">{{ form.new_repo_urls.errors.0 }}</p>
                            {% endif %}
                            <p class="mt-2 text-sm text-gray-600 dark:text-gray-400">{{ form.new_repo_urls.help_text }}</p>
                            <div class="mt-2 p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg">
                                <p class="text-sm text-blue-800 dark:text-blue-200">
                                    <strong>Tip:</strong> Enter one GitHub repository URL per line. New repositories will be created and automatically added to this hackathon.
                                </p>
                            </div>
                        </div>
                    </div>
                    <!-- Sponsorship Section -->
                    <div class="space-y-6">
                        <h2 class="text-2xl font-bold text-gray-900 dark:text-gray-100 pb-2 border-b-2 border-[#e74c3c]">
                            Sponsorship Information
                        </h2>
                        <p class="text-sm text-gray-600 dark:text-gray-400">
                            Provide sponsorship details to attract potential sponsors for your hackathon
                        </p>
                        <!-- Sponsor Note -->
                        <div>
                            <label for="{{ form.sponsor_note.id_for_label }}"
                                   class="block text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2">
                                Sponsorship Note
                            </label>
                            <textarea name="{{ form.sponsor_note.name }}" id="{{ form.sponsor_note.id_for_label }}" rows="4" class="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-[#e74c3c] focus:ring focus:ring-[#e74c3c] focus:ring-opacity-50 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100" placeholder="Describe sponsorship opportunities...">{{ form.sponsor_note.value|default:'' }}</textarea>
                            {% if form.sponsor_note.errors %}<p class="mt-2 text-sm text-red-600">{{ form.sponsor_note.errors.0 }}</p>{% endif %}
                            <p class="mt-2 text-sm text-gray-600 dark:text-gray-400">
                                Describe sponsorship opportunities and benefits for this hackathon
                            </p>
                        </div>
                        <!-- Sponsor Link -->
                        <div>
                            <label for="{{ form.sponsor_link.id_for_label }}"
                                   class="block text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2">
                                Sponsorship Link
                            </label>
                            <input type="url" name="{{ form.sponsor_link.name }}" value="{{ form.sponsor_link.value|default:'' }}" id="{{ form.sponsor_link.id_for_label }}" class="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-[#e74c3c] focus:ring focus:ring-[#e74c3c] focus:ring-opacity-50 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100" placeholder="https://example.com/sponsor">
                            {% if form.sponsor_link.errors %}<p class="mt-2 text-sm text-red-600">{{ form.sponsor_link.errors.0 }}</p>{% endif %}
                            <p class="mt-2 text-sm text-gray-600 dark:text-gray-400">
                                URL to your sponsorship information page or application form
                            </p>
                        </div>
                    </div>
                    <!-- Submit Button -->
                    <div class="pt-8 border-t border-gray-200 dark:border-gray-700">
                        <div class="flex flex-col sm:flex-row gap-4 justify-end">
                            <a href="{% url 'hackathons' %}"
                               class="px-8 py-3 text-lg font-semibold text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-800 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-colors text-center">
                                Cancel
                            </a>
                            <button type="submit"
                                    class="px-8 py-3 text-lg font-semibold text-white bg-[#e74c3c] rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#e74c3c] transition-colors shadow-lg hover:shadow-xl">
                                {{ submit_text }}
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
{% endblock content %}
{% block scripts %}
    {% if form.instance.pk %}
        <script>
        // Store selected repositories for editing mode
        window.selectedRepositories = [{% for repo in form.instance.repositories.all %}{{ repo.id }}{% if not forloop.last %},{% endif %}{% endfor %}];
        </script>
    {% endif %}
    <script src="{% static 'js/hackathon_form.js' %}"></script>
{% endblock scripts %}
